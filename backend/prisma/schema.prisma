generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                @id @default(autoincrement())
  email              String             @unique
  password           String
  name               String
  profilePhotoUrl    String?
  role               Role               @default(TEACHER)
  attendanceCategory AttendanceCategory
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  attendanceRecords  AttendanceRecord[]
  approvedLeaves     LeaveRequest[]     @relation("ApprovedByAdmin")
  leaveRequests      LeaveRequest[]
  schedules          Schedule[]
}

model Schedule {
  id                Int                @id @default(autoincrement())
  name              String
  startTime         DateTime
  endTime           DateTime
  latitude          Float
  longitude         Float
  radius            Int
  assignedToId      Int
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  attendanceRecords AttendanceRecord[]
  assignedTo        User               @relation(fields: [assignedToId], references: [id])
}

model AttendanceRecord {
  id                Int              @id @default(autoincrement())
  checkInTime       DateTime
  checkInPhotoUrl   String
  checkInLatitude   Float
  checkInLongitude  Float
  checkOutTime      DateTime?
  checkOutPhotoUrl  String?
  checkOutLatitude  Float?
  checkOutLongitude Float?
  status            AttendanceStatus
  userId            Int
  scheduleId        Int?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  schedule          Schedule?        @relation(fields: [scheduleId], references: [id])
  user              User             @relation(fields: [userId], references: [id])
}

model LeaveRequest {
  id           Int         @id @default(autoincrement())
  reason       String
  startDate    DateTime
  endDate      DateTime
  status       LeaveStatus @default(PENDING)
  userId       Int
  approvedById Int?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  approvedBy   User?       @relation("ApprovedByAdmin", fields: [approvedById], references: [id])
  user         User        @relation(fields: [userId], references: [id])
}

enum Role {
  TEACHER
  ADMIN
}

enum AttendanceCategory {
  PENGAJARAN
  KEHADIRAN_KERJA
}

enum AttendanceStatus {
  HADIR
  TERLAMBAT
  PULANG_CEPAT
  IZIN
  ABSEN
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}
